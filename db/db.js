"use strict";const check=require("check-types"),mongodb=require("mongodb"),MongoClient=mongodb.MongoClient,ObjectID=mongodb.ObjectID,Promise=require("bluebird"),fs=require("fs"),Logger=require("mongodb").Logger;let db=null;module.exports.db=function(){if(null===db)throw new Error("Mongo DB not connected!");return db},module.exports.ObjectID=ObjectID,module.exports.connect=async function(e){if(process.env.LOG_LEVEL&&Logger.setLevel(process.env.LOG_LEVEL.toLowerCase()),null!==db)return db;check.assert.object(e,"Invalid connection object."),e.uri?check.assert.string(e.uri,"Invalid connection.uri"):(check.assert.string(e.host,"Invalid connection.host."),check.assert.number(e.port,"Invalid connection.port."),check.assert.string(e.dbName,"Invalid connection.dbName."));let o=e.uri||"mongodb://"+e.host+":"+e.port+"/"+e.dbName,n={promiseLibrary:Promise};return e.sslCAPath&&(n.sslCA=fs.readFileSync(e.sslCAPath),e.hasOwnProperty("sslValidate")&&(n.sslValidate=e.sslValidate),e.hasOwnProperty("useSSL")&&null!==e.useSSL&&(n.ssl=e.useSSL)),db=await MongoClient.connect(o,n)};